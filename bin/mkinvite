#!/usr/bin/env python3

import argparse
import os
import json
import shlex
import subprocess

parser = argparse.ArgumentParser()
parser.add_argument("email", type=str)
parser.add_argument("--expires", type=str, default="10m")
args = parser.parse_args()

token = os.environ["TOKEN"]

payload = { "client": args.email, "expires_in": args.expires }
cmd = f"""
    curl -sX POST \
        -b "token={token}" \
        -H "Content-Type: application/json" \
        -d '{json.dumps(payload)}' \
        https://olmo-api.allen.ai/v3/invite/token
"""

out = subprocess.check_output(shlex.split(cmd))
resp = json.loads(out)

if "error" in resp:
    print(resp["error"])
    exit(1)

url = resp["url"]
email = f"""
Hi {args.email},

You've been invited to use the OLMo Demo. To do so click the URL below:
{url}

The above link will work for 7 days. Once clicked you'll have access to the
demo for 7 days.

If things don't work send a note to me (sams@allenai.org).

Best,
Sam
"""

subject = "Invite to OLMo Demo"

print()
print(subject)
print(email)
print()
